<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>我的AI交互应用</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f4f4f9; }
        #app { width: 100%; height: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #loading-text { font-size: 18px; color: #555; }
    </style>
</head>
<body>

    <div id="app">
        <p id="loading-text">正在加载AI应用，请稍候...</p>
    </div>

    <script type="text/javascript">
      // 页面加载时，立即从后端获取PAT
      document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/get-pat')
          .then(response => {
            if (!response.ok) {
              throw new Error('Could not fetch Personal Access Token from server.');
            }
            return response.json();
          })
          .then(data => {
            const personalAccessToken = data.token;
            console.log('成功获取令牌，正在加载Coze应用...');
            document.getElementById('loading-text').style.display = 'none'; // 隐藏加载文字
            loadCozeApp(personalAccessToken);
          })
          .catch(error => {
            console.error(error);
            document.getElementById('loading-text').innerText = 'AI应用加载失败，请检查服务器配置。';
          });
      });

      function loadCozeApp(token) {
        var webSdkScript = document.createElement('script');
        webSdkScript.src = 'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/builder-web-sdk/0.1.0/dist/umd/index.js';
        document.head.appendChild(webSdkScript);
        
        webSdkScript.onload = function () {
          new CozeWebSDK.AppWebSDK({
            // 关键改动：这里使用从后端获取的、你自己的PAT
            "token": token, 
            "appId": "7557948585896345610", // 你的App ID
            "container": "#app",
            "userInfo": {
              // 为每个访客生成一个临时的、唯一的ID
              "id": "visitor_" + Math.random().toString(36).substring(2), 
              "nickname": "访客"
            }
          });
        }
      }
    </script>

</body>
</html>